{% extends 'base.html' %} {% block content %}
<div class="property-detail airbnb-style">
  <div class="property-main-row">
    <div class="property-main-col">
      <h1 class="property-title">{{ propriedade.titulo }}</h1>
      <div class="property-host">
        Por
        <span>{{ propriedade.owner.get_full_name|default:propriedade.owner.username }}</span>
      </div>
      <div class="property-address">
        <span class="address-label">Endereço:</span>
        <span class="address-value">{{ propriedade.endereco }}, {{ propriedade.city }} - {{ propriedade.state }}</span>
      </div>
      <div class="property-desc">{{ propriedade.descricao }}</div>
      <div class="property-price">
        R$ {{ propriedade.preco_por_noite }}
        <span class="per-night">/ noite</span>
      </div>
      <div class="property-actions">
        {% if user.is_authenticated %} {% if propriedade.owner != user and propriedade.ativo %}
        <a class="btn btn-primary" href="{% url 'reservas:nova' propriedade.id %}">Solicitar reserva</a>
        <a class="btn btn-primary" href="{% url 'mensagens:start' propriedade.owner.id propriedade.id %}">
          Enviar mensagem ao dono
        </a>
        {% endif %} {% if propriedade.owner == user %}
        <form method="post" action="{% url 'propriedades:excluir' propriedade.id %}" style="display: inline">
          {% csrf_token %}
          <button class="btn btn-cancel" type="submit">Excluir imóvel</button>
        </form>
        {% endif %} {% else %}
        <p>
          <a href="{% url 'usuarios:login' %}">Faça login</a>
          para reservar.
        </p>
        {% endif %}
      </div>
    </div>
    <div class="property-side-col">
      <div class="property-gallery">
        {% if propriedade.imagens.all %}
        <div class="gallery">
            {% for img in propriedade.imagens.all %}
              <img src="{{ img.imagem.url }}" alt="{{ img.legenda }}" class="gallery-img" onclick="expandImg(this)" style="cursor:pointer;" />
            {% endfor %}
        </style>
        <div id="imgModal" class="img-modal" style="display:none;">
          <span class="close-modal" onclick="closeImgModal()">&times;</span>
          <img class="img-modal-content" id="modalImg">
          <div id="imgCaption"></div>
        </div>
        <script>
        function expandImg(img) {
          var modal = document.getElementById('imgModal');
          var modalImg = document.getElementById('modalImg');
          var caption = document.getElementById('imgCaption');
          modal.style.display = 'block';
          modalImg.src = img.src;
          caption.innerHTML = img.alt;
        }
        function closeImgModal() {
          document.getElementById('imgModal').style.display = 'none';
        }
        window.onclick = function(event) {
          var modal = document.getElementById('imgModal');
          if (event.target == modal) {
            modal.style.display = 'none';
          }
        }
        </script>
        <style>
          .property-address {
            font-size: 1rem;
            margin-bottom: 10px;
            color: #444;
          }
          .address-label {
            font-weight: 600;
            color: #4b6cb7;
            margin-right: 4px;
          }
          .img-modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100vw;
            height: 100vh;
            overflow: auto;
            background-color: rgba(0,0,0,0.85);
            align-items: center;
            justify-content: center;
          }
          .img-modal-content {
            margin: auto;
            display: block;
            max-width: 80vw;
            max-height: 80vh;
            border-radius: 12px;
            box-shadow: 0 2px 16px rgba(0,0,0,0.25);
          }
          #imgCaption {
            text-align: center;
            color: #fff;
            font-size: 1.1rem;
            margin-top: 12px;
          }
          .close-modal {
            position: absolute;
            top: 24px;
            right: 48px;
            color: #fff;
            font-size: 2.5rem;
            font-weight: bold;
            cursor: pointer;
            z-index: 10001;
          }
        </style>
        </div>
        {% endif %}
      </div>
      <div class="property-amenities">
        <h3>Comodidades</h3>
        <ul class="amenities-list">
          {% for cod, label in amenities_choices %} {% if propriedade.comodidades and cod in propriedade.comodidades %}
          <li class="amenity">
            <span class="amenity-icon">✔️</span>
            {{ label }}
          </li>
          {% endif %} {% endfor %} {% if not propriedade.comodidades %}
          <li class="amenity">Nenhuma comodidade informada.</li>
          {% endif %}
        </ul>
      </div>
    </div>
  </div>
</div>
<style>
  .property-main-row {
    display: flex;
    gap: 48px;
    align-items: flex-start;
    flex-wrap: wrap;
  }
  .property-main-col {
    flex: 2;
    min-width: 320px;
  }
  .property-side-col {
    flex: 1;
    min-width: 260px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
  }
  .property-title {
    font-size: 2.2rem;
    font-weight: 700;
    margin-bottom: 8px;
  }
  .property-host {
    font-size: 1.1rem;
    color: #4b6cb7;
    margin-bottom: 12px;
  }
  .property-desc {
    font-size: 1.1rem;
    margin-bottom: 18px;
  }
  .property-price {
    font-size: 1.3rem;
    color: #28a745;
    font-weight: 600;
    margin-bottom: 18px;
  }
  .property-gallery {
    margin-bottom: 12px;
  }
  .gallery {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }
  .gallery-img {
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    max-width: 180px;
    max-height: 140px;
    object-fit: cover;
    background: #f5f7fb;
    border: 2px solid #e0e6ef;
  }
  .property-amenities {
    margin-top: 8px;
    width: 100%;
  }
  .property-amenities h3 {
    color: #28a745;
    font-size: 1.2rem;
    margin-bottom: 8px;
    font-weight: 700;
    text-align: left;
  }
  .amenities-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  .amenity {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1rem;
    margin-bottom: 6px;
    color: #28a745;
    font-weight: 500;
  }
  .amenity-icon {
    color: #4b6cb7;
    font-size: 1.2rem;
  }
</style>
{% endblock %}
